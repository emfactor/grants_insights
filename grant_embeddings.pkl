import pandas as pd
from sentence_transformers import SentenceTransformer
import pickle

# Load your cleaned CSV
df = pd.read_csv("cleaned_grants_dataset.csv")

# Combine relevant text for matching
grant_texts = (df["Grant Title"].fillna('') + " " + df["Grant Description"].fillna('')).tolist()

# Load model
model = SentenceTransformer('all-MiniLM-L6-v2')

# Compute embeddings (takes ~3–5 mins for 90K rows)
embeddings = model.encode(grant_texts, show_progress_bar=True)

# Save results
with open("grant_embeddings.pkl", "wb") as f:
    pickle.dump(embeddings, f)

print("✅ Embeddings saved to grant_embeddings.pkl")
